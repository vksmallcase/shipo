(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{116:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n=a(5),o=a.n(n),s=a(0),l=a.n(s),r=a(2),i=a.n(r),c=a(67),d=a(485),h=a(21),u=a(1);const p={dialogClassName:i.a.string,animation:i.a.bool,triggerNode:i.a.node.isRequired,modalTitle:i.a.node,modalBody:i.a.node,modalFooter:i.a.node,beforeOpen:i.a.func,onExit:i.a.func,isButton:i.a.bool,isMenuItem:i.a.bool,bsSize:i.a.oneOf(["large","small"]),className:i.a.string,tooltip:i.a.string,backdrop:i.a.oneOf(["static",!0,!1])};class b extends l.a.Component{constructor(e){var t,a;super(e),this.state={showModal:!1},this.open=o()(t=this.open).call(t,this),this.close=o()(a=this.close).call(a,this)}close(){this.setState(()=>({showModal:!1}))}open(e){e.preventDefault(),this.props.beforeOpen(),this.setState(()=>({showModal:!0}))}renderModal(){return Object(u.e)(c.a,{dialogClassName:this.props.dialogClassName,animation:this.props.animation,show:this.state.showModal,onHide:this.close,onExit:this.props.onExit,bsSize:this.props.bsSize,className:this.props.className,backdrop:this.props.backdrop},this.props.modalTitle&&Object(u.e)(c.a.Header,{closeButton:!0},Object(u.e)(c.a.Title,null,this.props.modalTitle)),Object(u.e)(c.a.Body,null,this.props.modalBody),this.props.modalFooter&&Object(u.e)(c.a.Footer,null,this.props.modalFooter))}render(){return this.props.isButton?Object(u.e)(l.a.Fragment,null,Object(u.e)(h.a,{className:"modal-trigger",tooltip:this.props.tooltip,onClick:this.open},this.props.triggerNode),this.renderModal()):this.props.isMenuItem?Object(u.e)(l.a.Fragment,null,Object(u.e)(d.a,{onClick:this.open},this.props.triggerNode),this.renderModal()):Object(u.e)(l.a.Fragment,null,Object(u.e)("span",{onClick:this.open,role:"button"},this.props.triggerNode),this.renderModal())}}b.propTypes=p,b.defaultProps={animation:!0,beforeOpen:()=>{},onExit:()=>{},isButton:!1,isMenuItem:!1,bsSize:null,className:"",modalTitle:""}},1233:function(e,t,a){},154:function(e,t,a){var n,o,s;o=[t],void 0===(s="function"==typeof(n=function(e){var t,a,n,o=e;void 0===o&&(window.rison={}),o.uri_ok={"~":!0,"!":!0,"*":!0,"(":!0,")":!0,"-":!0,_:!0,".":!0,",":!0,":":!0,"@":!0,$:!0,"'":!0,"/":!0},function(){for(var e=[],t=0;t<16;t++)for(var a=0;a<16;a++)if(t+a!=0){var n=String.fromCharCode(16*t+a);/\w|[-_.\/~]/.test(n)||e.push("\\u00"+t.toString(16)+a.toString(16))}o.not_idchar=e.join("")}(),o.not_idchar=" '!:(),*@$",o.not_idstart="-0123456789",n="[^"+o.not_idstart+o.not_idchar+"][^"+o.not_idchar+"]*",o.id_ok=new RegExp("^"+n+"$"),o.next_id=new RegExp(n,"g"),o.quote=function(e){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(e)?e:encodeURIComponent(e).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g").replace("%20","+","g")},t={"'":!0,"!":!0},a={array:function(e){var t,n,o,s,l=["!("],r=e.length;for(o=0;o<r;o+=1)s=e[o],(n=a[typeof s])&&"string"==typeof(s=n(s))&&(t&&(l[l.length]=","),l[l.length]=s,t=!0);return l[l.length]=")",l.join("")},boolean:function(e){return e?"!t":"!f"},null:function(e){return"!n"},number:function(e){return isFinite(e)?String(e).replace(/\+/,""):"!n"},object:function(e){if(e){if(e instanceof Array)return a.array(e);if("object"==typeof e.__prototype__&&void 0!==e.__prototype__.encode_rison)return e.encode_rison();var t,n,o,s,l,r=["("],i=[];for(o in e)i[i.length]=o;for(i.sort(),l=0;l<i.length;l++)s=e[o=i[l]],(n=a[typeof s])&&"string"==typeof(s=n(s))&&(t&&(r[r.length]=","),r.push(a.string(o),":",s),t=!0);return r[r.length]=")",r.join("")}return"!n"},string:function(e){return""==e?"''":o.id_ok.test(e)?e:"'"+(e=e.replace(/(['!])/g,(function(e,a){return t[a]?"!"+a:a})))+"'"},undefined:function(e){throw new Error("rison can't encode the undefined value")}},o.encode=function(e){return a[typeof e](e)},o.encode_object=function(e){if("object"!=typeof e||null===e||e instanceof Array)throw new Error("rison.encode_object expects an object argument");var t=a[typeof e](e);return t.substring(1,t.length-1)},o.encode_array=function(e){if(!(e instanceof Array))throw new Error("rison.encode_array expects an array argument");var t=a[typeof e](e);return t.substring(2,t.length-1)},o.encode_uri=function(e){return o.quote(a[typeof e](e))},o.decode=function(e){return new o.parser((function(e){throw Error("rison decoder error: "+e)})).parse(e)},o.decode_object=function(e){return o.decode("("+e+")")},o.decode_array=function(e){return o.decode("!("+e+")")},o.parser=function(e){this.errorHandler=e},o.parser.WHITESPACE="",o.parser.prototype.setOptions=function(e){e.errorHandler&&(this.errorHandler=e.errorHandler)},o.parser.prototype.parse=function(e){this.string=e,this.index=0,this.message=null;var t=this.readValue();return!this.message&&this.next()&&(t=this.error("unable to parse string as rison: '"+o.encode(e)+"'")),this.message&&this.errorHandler&&this.errorHandler(this.message,this.index),t},o.parser.prototype.error=function(e){"undefined"!=typeof console&&console.log("rison parser error: ",e),this.message=e},o.parser.prototype.readValue=function(){var e=this.next(),t=e&&this.table[e];if(t)return t.apply(this);var a=this.string,n=this.index-1;o.next_id.lastIndex=n;var s=o.next_id.exec(a);if(s.length>0){var l=s[0];return this.index=n+l.length,l}return e?this.error("invalid character: '"+e+"'"):this.error("empty expression")},o.parser.parse_array=function(e){for(var t,a=[];")"!=(t=e.next());){if(!t)return e.error("unmatched '!('");if(a.length)","!=t&&e.error("missing ','");else{if(","==t)return e.error("extra ','");--e.index}var n=e.readValue();if(void 0===n)return;a.push(n)}return a},o.parser.bangs={t:!0,f:!1,n:null,"(":o.parser.parse_array},o.parser.prototype.table={"!":function(){var e=this.string.charAt(this.index++);if(!e)return this.error('"!" at end of input');var t=o.parser.bangs[e];return"function"==typeof t?t.call(null,this):void 0===t?this.error('unknown literal: "!'+e+'"'):t},"(":function(){for(var e,t={},a=0;")"!=(e=this.next());){if(a)","!=e&&this.error("missing ','");else{if(","==e)return this.error("extra ','");--this.index}var n=this.readValue();if(void 0===n)return;if(":"!=this.next())return this.error("missing ':'");var o=this.readValue();if(void 0===o)return;t[n]=o,a++}return t},"'":function(){for(var e,t=this.string,a=this.index,n=a,o=[];"'"!=(e=t.charAt(a++));){if(!e)return this.error('unmatched "\'"');if("!"==e){if(n<a-1&&o.push(t.slice(n,a-1)),e=t.charAt(a++),!("!'".indexOf(e)>=0))return this.error('invalid string escape: "!'+e+'"');o.push(e),n=a}}return n<a-1&&o.push(t.slice(n,a-1)),this.index=a,1==o.length?o[0]:o.join("")},"-":function(){var e=this.string,t=this.index,a=t-1,n="int",o="-",s={"int+.":"frac","int+e":"exp","frac+e":"exp"};do{var l=e.charAt(t++);if(!l)break;"0"<=l&&l<="9"||(o.indexOf(l)>=0?o="":"exp"==(n=s[n+"+"+l.toLowerCase()])&&(o="-"))}while(n);return this.index=--t,"-"==(e=e.slice(a,t))?this.error("invalid number"):Number(e)}},function(e){for(var t=0;t<=9;t++)e[String(t)]=e["-"]}(o.parser.prototype.table),o.parser.prototype.next=function(){var e=this.string,t=this.index;do{if(t==e.length)return;var a=e.charAt(t++)}while(o.parser.WHITESPACE.indexOf(a)>=0);return this.index=t,a}})?n.apply(t,o):n)||(e.exports=s)},1564:function(e,t,a){"use strict";a.r(t);a(33);var n=a(49),o=a.n(n),s=a(29),l=a.n(s),r=a(44),i=a.n(r),c=a(6),d=a.n(c),h=a(3),u=a.n(h),p=a(5),b=a.n(p),m=a(14),g=a.n(m),f=a(10),O=a.n(f),j=a(11),C=a.n(j),y=a(0),v=a.n(y),x=a(2),S=a.n(x),w=a(1681),_=a(1692),T=a(1690),E=a(1689),k=a(692),D=a(1027),I=a(1691),N=a(77),R=a.n(N),L=a(56),A=a(7),M=a(89),K=a(21),F=a(37),q=a(83),P=a(1);var B=function({certifiedBy:e,details:t}){return Object(P.e)(q.a,{label:"certified-details",tooltip:Object(P.e)(v.a.Fragment,null,e&&Object(P.e)("div",null,Object(A.c)("Certified by %s",e)),Object(P.e)("div",null,t))},Object(P.e)(F.a,{color:L.b.colors.primary.base,name:"certified"}))},H=a(938),z=a(63),V=a(123),U=a(993),W=a(469),G=a(51),Q=a(276),Z=a(206),$=a(248),J=a(934),Y=a(933),X=a(935),ee=a(30),te=a.n(ee),ae=a(252),ne=a.n(ae),oe=a(1684);function se(e,t,a){var n;return d()(n=v.a.Children).call(n,e,e=>{let n=e;return e&&e.type.name===t.name&&(n=v.a.cloneElement(e,a(e))),n&&n.props.children&&(n=v.a.cloneElement(n,{children:se(n.props.children,t,a)})),n})}a(173);var le=a(314),re=a(91),ie=a(136),ce=a(306),de=a(1685),he=a(69);a(3498);const ue={value:S.a.any,label:S.a.string.isRequired,description:S.a.node,fieldKey:S.a.string.isRequired,control:S.a.node.isRequired,onChange:S.a.func,compact:S.a.bool};class pe extends v.a.PureComponent{constructor(e){var t;super(e),this.onChange=b()(t=this.onChange).call(t,this)}onChange(e){this.props.onChange(this.props.fieldKey,e)}render(){const{compact:e,value:t,label:a,control:n,description:o,fieldKey:s}=this.props,l=v.a.cloneElement(n,{value:t,onChange:this.onChange});return Object(P.e)(le.a,{controlId:s},Object(P.e)(he.a,{className:"m-r-5"},a||s,e&&o&&Object(P.e)(re.a,{placement:"right",overlay:Object(P.e)(ie.a,{id:"field-descr",bsSize:"lg"},o)},Object(P.e)("i",{className:"fa fa-info-circle m-l-5"}))),l,Object(P.e)(ce.a.Feedback,null),!e&&o&&Object(P.e)(de.a,null,o))}}pe.propTypes=ue,pe.defaultProps={controlProps:{},onChange:()=>{},compact:!1,desc:null};const be={children:S.a.node.isRequired,onChange:S.a.func,item:S.a.object,title:S.a.node,compact:S.a.bool};class me extends v.a.PureComponent{constructor(e){var t;super(e),this.onChange=b()(t=this.onChange).call(t,this)}onChange(e,t){return this.props.onChange(u()({},this.props.item,{[e]:t}))}render(){const{title:e}=this.props;return Object(P.e)(oe.a,{componentClass:"fieldset",className:"CRUD"},e&&Object(P.e)("legend",null,e),se(this.props.children,pe,e=>({onChange:this.onChange,value:this.props.item[e.props.fieldKey],compact:this.props.compact})))}}function ge(e){const t=d()(e).call(e,e=>u()({},e,{id:e.id||R.a.generate()})),a={};return O()(t).call(t,e=>{a[e.id]=e}),a}me.propTypes=be,me.defaultProps={compact:!1,title:null};class fe extends v.a.PureComponent{constructor(e){var t,a,n,o,s,l,r;super(e),this.state={expandedColumns:{},collection:ge(e.collection)},this.renderItem=b()(t=this.renderItem).call(t,this),this.onAddItem=b()(a=this.onAddItem).call(a,this),this.renderExpandableSection=b()(n=this.renderExpandableSection).call(n,this),this.getLabel=b()(o=this.getLabel).call(o,this),this.onFieldsetChange=b()(s=this.onFieldsetChange).call(s,this),this.renderTableBody=b()(l=this.renderTableBody).call(l,this),this.changeCollection=b()(r=this.changeCollection).call(r,this)}UNSAFE_componentWillReceiveProps(e){e.collection!==this.props.collection&&this.setState({collection:ge(e.collection)})}onCellChange(e,t,a){this.changeCollection(u()({},this.state.collection,{[e]:u()({},this.state.collection[e],{[t]:a})}))}onAddItem(){if(this.props.itemGenerator){let e=this.props.itemGenerator();e.id||(e=u()({},e,{id:R.a.generate()})),this.changeCollection(u()({},this.state.collection,{[e.id]:e}))}}onFieldsetChange(e){this.changeCollection(u()({},this.state.collection,{[e.id]:e}))}getLabel(e){const{columnLabels:t}=this.props;let a=t&&t[e]?t[e]:e;return ne()(a).call(a,"__")&&(a=""),a}changeCollection(e){var t;(this.setState({collection:e}),this.props.onChange)&&this.props.onChange(d()(t=te()(e)).call(t,t=>e[t]))}deleteItem(e){const t=u()({},this.state.collection);delete t[e],this.changeCollection(t)}effectiveTableColumns(){var e;const{tableColumns:t,allowDeletes:a,expandFieldset:n}=this.props,s=a?o()(t).call(t,["__actions"]):t;return n?o()(e=["__expand"]).call(e,s):s}toggleExpand(e){this.onCellChange(e,"__expanded",!1),this.setState(t=>({expandedColumns:u()({},t.expandedColumns,{[e]:!t.expandedColumns[e]})}))}renderHeaderRow(){const e=this.effectiveTableColumns(),{allowDeletes:t,expandFieldset:a,extraButtons:n}=this.props;return Object(P.e)("thead",null,Object(P.e)("tr",null,a&&Object(P.e)("th",{"aria-label":"Expand",className:"tiny-cell"}),d()(e).call(e,e=>Object(P.e)("th",{key:e},this.getLabel(e))),n,t&&Object(P.e)("th",{key:"delete-item","aria-label":"Delete",className:"tiny-cell"})))}renderExpandableSection(e){return se(this.props.expandFieldset,me,()=>({item:e,onChange:this.onFieldsetChange}))}renderCell(e,t){var a;const n=this.props.itemRenderers&&this.props.itemRenderers[t],o=e[t],s=b()(a=this.onCellChange).call(a,this,e.id,t);return n?n(o,s,this.getLabel(t),e):o}renderItem(e){const{allowAddItem:t,allowDeletes:a,expandFieldset:n,tableColumns:s}=this.props,l=!!this.state.expandedColumns[e.id]||e.__expanded;let r=[];var i,c;n&&r.push(Object(P.e)("td",{key:"__expand",className:"expand"},Object(P.e)("i",{role:"button","aria-label":"Toggle expand",tabIndex:0,className:"fa fa-caret-"+(l?"down":"right")+" text-primary pointer",onClick:b()(i=this.toggleExpand).call(i,this,e.id)})));(r=o()(r).call(r,d()(s).call(s,t=>Object(P.e)("td",{key:t},this.renderCell(e,t)))),t&&r.push(Object(P.e)("td",{key:"add"})),a)&&r.push(Object(P.e)("td",{key:"__actions"},Object(P.e)("i",{role:"button","aria-label":"Delete item",tabIndex:0,className:"fa fa-trash text-primary pointer",onClick:b()(c=this.deleteItem).call(c,this,e.id)})));const h=[Object(P.e)("tr",{className:"row",key:e.id},r)];return l&&h.push(Object(P.e)("tr",{className:"exp",key:"exp__"+e.id},Object(P.e)("td",{colSpan:this.effectiveTableColumns().length,className:"expanded"},Object(P.e)("div",null,this.renderExpandableSection(e))))),h}renderEmptyCell(){return Object(P.e)("tr",null,Object(P.e)("td",{className:"empty-collection"},this.props.emptyMessage))}renderTableBody(){var e;const t=d()(e=te()(this.state.collection)).call(e,e=>this.state.collection[e]),a=t.length?d()(t).call(t,e=>this.renderItem(e)):this.renderEmptyCell();return Object(P.e)("tbody",null,a)}render(){return Object(P.e)("div",{className:"CRUD"},Object(P.e)("span",{className:"float-right m-t-10 m-r-10"},this.props.allowAddItem&&Object(P.e)(K.a,{buttonSize:"sm",buttonStyle:"primary",onClick:this.onAddItem},Object(P.e)("i",{className:"fa fa-plus"})," ",Object(A.c)("Add Item"))),Object(P.e)("table",{className:"table"},this.renderHeaderRow(),this.renderTableBody()))}}var Oe=a(73);function je(){const e=C()(["\n  align-items: center;\n  display: flex;\n\n  > svg {\n    margin-right: ","px;\n  }\n"]);return je=function(){return e},e}function Ce(){const e=C()(["\n  .change-warning {\n    margin: 16px 10px 0;\n    color: ",";\n  }\n\n  .change-warning .bold {\n    font-weight: ",";\n  }\n"]);return Ce=function(){return e},e}const ye=L.a.div(Ce(),({theme:e})=>e.colors.warning.base,({theme:e})=>e.typography.weights.bold),ve=L.a.div(je(),({theme:e})=>e.gridUnit),xe=(e,t)=>Object(P.e)(Q.a,{value:e,onChange:t}),Se=["STRING","NUMERIC","DATETIME"],we=[{key:"physical",label:Object(A.c)("Physical (table or view)")},{key:"virtual",label:Object(A.c)("Virtual (SQL)")}],_e={};function Te({title:e,collection:t}){return Object(P.e)("div",null,e," ",Object(P.e)(w.a,null,t?t.length:0))}function Ee({columns:e,onChange:t,editableColumnName:a,showExpression:n,allowAddItem:o,allowEditDataType:s,itemGenerator:l}){return Object(P.e)(fe,{collection:e,tableColumns:["column_name","type","is_dttm","filterable","groupby"],allowDeletes:!0,allowAddItem:o,itemGenerator:l,expandFieldset:Object(P.e)(De,null,Object(P.e)(me,{compact:!0},n&&Object(P.e)(pe,{fieldKey:"expression",label:Object(A.c)("SQL Expression"),control:Object(P.e)(J.a,{language:"markdown",offerEditInModal:!1})}),Object(P.e)(pe,{fieldKey:"verbose_name",label:Object(A.c)("Label"),control:Object(P.e)(Z.a,{controlId:"verbose_name",placeholder:Object(A.c)("Label")})}),Object(P.e)(pe,{fieldKey:"description",label:Object(A.c)("Description"),control:Object(P.e)(Z.a,{controlId:"description",placeholder:Object(A.c)("Description")})}),s&&Object(P.e)(pe,{fieldKey:"type",label:Object(A.c)("Data Type"),control:Object(P.e)($.a,{choices:Se,name:"type",freeForm:!0})}),Object(P.e)(pe,{fieldKey:"python_date_format",label:Object(A.c)("Datetime Format"),description:Object(P.e)("div",null,Object(A.c)("The pattern of timestamp format. For strings use "),Object(P.e)("a",{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior"},Object(A.c)("python datetime string pattern")),Object(A.c)(" expression which needs to adhere to the "),Object(P.e)("a",{href:"https://en.wikipedia.org/wiki/ISO_8601"},Object(A.c)("ISO 8601")),Object(A.c)(" standard to ensure that the lexicographical ordering\n                      coincides with the chronological ordering. If the\n                      timestamp format does not adhere to the ISO 8601 standard\n                      you will need to define an expression and type for\n                      transforming the string into a date or timestamp. Note\n                      currently time zones are not supported. If time is stored\n                      in epoch format, put `epoch_s` or `epoch_ms`. If no pattern\n                      is specified we fall back to using the optional defaults on a per\n                      database/column name level via the extra parameter.")),control:Object(P.e)(Z.a,{controlId:"python_date_format",placeholder:"%y/%m/%d"})}))),columnLabels:{column_name:Object(A.c)("Column"),type:Object(A.c)("Data Type"),groupby:Object(A.c)("Is Dimension"),is_dttm:Object(A.c)("Is Temporal"),filterable:Object(A.c)("Is Filterable")},onChange:t,itemRenderers:{column_name:(e,t)=>a?Object(P.e)(W.a,{canEdit:!0,title:e,onSaveTitle:t}):e,type:e=>Object(P.e)(z.a,null,e),is_dttm:xe,filterable:xe,groupby:xe}})}function ke({label:e,formElement:t}){return Object(P.e)("div",null,Object(P.e)("div",null,Object(P.e)("strong",null,e)),Object(P.e)("div",null,t))}function De({children:e}){return Object(P.e)(_.a,{style:{marginTop:20}},e)}O()(we).call(we,e=>{_e[e.key]=e}),Te.propTypes={title:S.a.string,collection:S.a.array},Ee.propTypes={columns:S.a.array.isRequired,onChange:S.a.func.isRequired,editableColumnName:S.a.bool,showExpression:S.a.bool,allowAddItem:S.a.bool,allowEditDataType:S.a.bool,itemGenerator:S.a.func},Ee.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:()=>({column_name:"<new column>",filterable:!0,groupby:!0})},ke.propTypes={label:S.a.string,formElement:S.a.node},De.propTypes={children:S.a.node};const Ie={datasource:S.a.object.isRequired,onChange:S.a.func,addSuccessToast:S.a.func.isRequired,addDangerToast:S.a.func.isRequired};class Ne extends v.a.PureComponent{constructor(e){var t,a,n,o,s,l,r,i,c;super(e),this.state={datasource:e.datasource,errors:[],isDruid:"druid"===e.datasource.type||"druid"===e.datasource.datasource_type,isSqla:"table"===e.datasource.datasource_type||"table"===e.datasource.type,databaseColumns:g()(t=e.datasource.columns).call(t,e=>!e.expression),calculatedColumns:g()(a=e.datasource.columns).call(a,e=>!!e.expression),metadataLoading:!1,activeTabKey:0,datasourceType:e.datasource.sql?_e.virtual.key:_e.physical.key},this.onChange=b()(n=this.onChange).call(n,this),this.onDatasourcePropChange=b()(o=this.onDatasourcePropChange).call(o,this),this.onDatasourceChange=b()(s=this.onDatasourceChange).call(s,this),this.syncMetadata=b()(l=this.syncMetadata).call(l,this),this.setColumns=b()(r=this.setColumns).call(r,this),this.validateAndChange=b()(i=this.validateAndChange).call(i,this),this.handleTabSelect=b()(c=this.handleTabSelect).call(c,this)}onChange(){const{datasourceType:e,datasource:t}=this.state,a=e===_e.physical.key?"":t.sql,n=u()({},this.state.datasource,{sql:a,columns:[...this.state.databaseColumns,...this.state.calculatedColumns]});this.props.onChange(n,this.state.errors)}onDatasourceChange(e){this.setState({datasource:e},this.validateAndChange)}onDatasourcePropChange(e,t){const a=u()({},this.state.datasource,{[e]:t});this.setState(a=>({datasource:u()({},a.datasource,{[e]:t})}),this.onDatasourceChange(a))}onDatasourceTypeChange(e){this.setState({datasourceType:e})}setColumns(e){this.setState(e,this.validateAndChange)}validateAndChange(){this.validate(this.onChange)}updateColumns(e){var t;const{databaseColumns:a}=this.state,n=d()(e).call(e,e=>e.name),o=i()(a).call(a,(e,t)=>u()({},e,{[t.column_name]:t}),{}),s=[],r={added:[],modified:[],removed:g()(t=d()(a).call(a,e=>e.column_name)).call(t,e=>!l()(n).call(n,e))};return O()(e).call(e,e=>{const t=o[e.name];t?t.type!==e.type?(s.push(u()({},t,{type:e.type})),r.modified.push(e.name)):s.push(t):(s.push({id:R.a.generate(),column_name:e.name,type:e.type,groupby:!0,filterable:!0}),r.added.push(e.name))}),(r.added.length||r.modified.length||r.removed.length)&&this.setColumns({databaseColumns:s}),r}syncMetadata(){const{datasource:e}=this.state,t="/datasource/external_metadata/"+(e.type||e.datasource_type)+"/"+e.id+"/?db_id="+e.database.id+"&schema="+(e.schema||"")+"&table_name="+(e.datasource_name||e.table_name);this.setState({metadataLoading:!0}),M.a.get({endpoint:t}).then(({json:e})=>{const t=this.updateColumns(e);t.modified.length&&this.props.addSuccessToast(Object(A.c)("Modified columns: %s",t.modified.join(", "))),t.removed.length&&this.props.addSuccessToast(Object(A.c)("Removed columns: %s",t.removed.join(", "))),t.added.length&&this.props.addSuccessToast(Object(A.c)("New columns added: %s",t.added.join(", "))),this.props.addSuccessToast(Object(A.c)("Metadata has been synced")),this.setState({metadataLoading:!1})}).catch(e=>Object(G.a)(e).then(({error:e,statusText:t})=>{this.props.addDangerToast(e||t||Object(A.c)("An error has occurred")),this.setState({metadataLoading:!1})}))}findDuplicates(e,t){const a={},n=[];return O()(e).call(e,e=>{const o=t(e);o in a?n.push(o):a[o]=null}),n}validate(e){var t;let a,n=[];const{datasource:s}=this.state;a=this.findDuplicates(s.columns,e=>e.column_name),n=o()(n).call(n,d()(a).call(a,e=>Object(A.c)("Column name [%s] is duplicated",e))),a=this.findDuplicates(s.metrics,e=>e.metric_name),n=o()(n).call(n,d()(a).call(a,e=>Object(A.c)("Metric name [%s] is duplicated",e)));const l=g()(t=this.state.calculatedColumns).call(t,e=>!e.expression&&!e.json);n=o()(n).call(n,d()(l).call(l,e=>Object(A.c)("Calculated column [%s] requires an expression",e.column_name))),this.setState({errors:n},e)}handleTabSelect(e){this.setState({activeTabKey:e})}renderSettingsFieldset(){const{datasource:e}=this.state;return Object(P.e)(me,{title:Object(A.c)("Basic"),item:e,onChange:this.onDatasourceChange},Object(P.e)(pe,{fieldKey:"description",label:Object(A.c)("Description"),control:Object(P.e)(J.a,{language:"markdown",offerEditInModal:!1})}),Object(P.e)(pe,{fieldKey:"default_endpoint",label:Object(A.c)("Default URL"),description:Object(A.c)("Default URL to redirect to when accessing from the dataset list page"),control:Object(P.e)(Z.a,{controlId:"default_endpoint"})}),Object(P.e)(pe,{fieldKey:"filter_select_enabled",label:Object(A.c)("Autocomplete filters"),description:Object(A.c)("Whether to populate autocomplete filters options"),control:Object(P.e)(Q.a,null)}),this.state.isSqla&&Object(P.e)(pe,{fieldKey:"fetch_values_predicate",label:Object(A.c)("Autocomplete Query Predicate"),description:Object(A.c)('When using "Autocomplete filters", this can be used to improve performance of the query fetching the values. Use this option to apply a predicate (WHERE clause) to the query selecting the distinct values from the table. Typically the intent would be to limit the scan by applying a relative time filter on a partitioned or indexed time-related field.'),control:Object(P.e)(Z.a,{controlId:"fetch_values_predicate"})}),Object(P.e)(pe,{fieldKey:"owners",label:Object(A.c)("Owners"),description:Object(A.c)("Owners of the datasource"),control:Object(P.e)(Y.a,{dataEndpoint:"api/v1/dataset/related/owners",multi:!0,mutator:e=>{var t;return d()(t=e.result).call(t,e=>({value:e.value,label:""+e.text}))}}),controlProps:{}}))}renderAdvancedFieldset(){const{datasource:e}=this.state;return Object(P.e)(me,{title:Object(A.c)("Advanced"),item:e,onChange:this.onDatasourceChange},Object(P.e)(pe,{fieldKey:"cache_timeout",label:Object(A.c)("Cache Timeout"),description:Object(A.c)("The duration of time in seconds before the cache is invalidated"),control:Object(P.e)(Z.a,{controlId:"cache_timeout"})}),Object(P.e)(pe,{fieldKey:"offset",label:Object(A.c)("Hours offset"),control:Object(P.e)(Z.a,{controlId:"offset"})}),this.state.isSqla&&Object(P.e)(pe,{fieldKey:"template_params",label:Object(A.c)("Template parameters"),description:Object(A.c)("A set of parameters that become available in the query using Jinja templating syntax"),control:Object(P.e)(Z.a,{controlId:"template_params"})}))}renderSpatialTab(){var e;const{datasource:t}=this.state,{spatials:a,all_cols:n}=t;return Object(P.e)(T.a,{title:Object(P.e)(Te,{collection:a,title:Object(A.c)("Spatial")}),eventKey:4},Object(P.e)(fe,{tableColumns:["name","config"],onChange:b()(e=this.onDatasourcePropChange).call(e,this,"spatials"),itemGenerator:()=>({name:"<new spatial>",type:"<no type>",config:null}),collection:a,allowDeletes:!0,itemRenderers:{name:(e,t)=>Object(P.e)(W.a,{canEdit:!0,title:e,onSaveTitle:t}),config:(e,t)=>Object(P.e)(X.a,{value:e,onChange:t,choices:n})}}))}renderSourceFieldset(){const{datasource:e}=this.state;return Object(P.e)("div",null,Object(P.e)("div",{className:"m-l-10 m-t-20 m-b-10"},d()(we).call(we,e=>{var t;return Object(P.e)(E.a,{value:e.key,inline:!0,onChange:b()(t=this.onDatasourceTypeChange).call(t,this,e.key),checked:this.state.datasourceType===e.key},e.label)})),Object(P.e)("hr",null),Object(P.e)(me,{item:e,onChange:this.onDatasourceChange,compact:!0},this.state.datasourceType===_e.virtual.key&&Object(P.e)("div",null,this.state.isSqla&&Object(P.e)(v.a.Fragment,null,Object(P.e)(pe,{fieldKey:"databaseSelector",label:Object(A.c)("virtual"),control:Object(P.e)(H.a,{dbId:e.database.id,schema:e.schema,onSchemaChange:e=>this.onDatasourcePropChange("schema",e),onDbChange:e=>this.onDatasourcePropChange("database",e),formMode:!1,handleError:this.props.addDangerToast})}),Object(P.e)(pe,{fieldKey:"table_name",label:Object(A.c)("dataset name"),control:Object(P.e)(Z.a,{controlId:"table_name",onChange:e=>{this.onDatasourcePropChange("table_name",e)},placeholder:Object(A.c)("dataset name")})}),Object(P.e)(pe,{fieldKey:"sql",label:Object(A.c)("SQL"),description:Object(A.c)("When specifying SQL, the datasource acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries."),control:Object(P.e)(J.a,{language:"sql",offerEditInModal:!1,minLines:25,maxLines:25})})),this.state.isDruid&&Object(P.e)(pe,{fieldKey:"json",label:Object(A.c)("JSON"),description:Object(P.e)("div",null,Object(A.c)("The JSON metric or post aggregation definition.")),control:Object(P.e)(J.a,{language:"json",offerEditInModal:!1})})),this.state.datasourceType===_e.physical.key&&Object(P.e)(k.a,{md:6},this.state.isSqla&&Object(P.e)(pe,{fieldKey:"tableSelector",label:Object(A.c)("Physical"),control:Object(P.e)(U.a,{clearable:!1,dbId:e.database.id,handleError:this.props.addDangerToast,schema:e.schema,sqlLabMode:!1,tableName:e.table_name,onSchemaChange:e=>this.onDatasourcePropChange("schema",e),onDbChange:e=>this.onDatasourcePropChange("database",e),onTableChange:e=>{this.onDatasourcePropChange("table_name",e)},isDatabaseSelectEnabled:!1}),description:Object(A.c)("The pointer to a physical table (or view). Keep in mind that the chart is associated to this Superset logical table, and this logical table points the physical table referenced here.")}))))}renderErrors(){var e;return this.state.errors.length>0?Object(P.e)(D.a,{bsStyle:"danger"},d()(e=this.state.errors).call(e,e=>Object(P.e)("div",{key:e},e))):null}renderMetricCollection(){var e;return Object(P.e)(fe,{tableColumns:["metric_name","verbose_name","expression"],columnLabels:{metric_name:Object(A.c)("Metric"),verbose_name:Object(A.c)("Label"),expression:Object(A.c)("SQL Expression")},expandFieldset:Object(P.e)(De,null,Object(P.e)(me,{compact:!0},Object(P.e)(pe,{fieldKey:"verbose_name",label:Object(A.c)("Label"),control:Object(P.e)(Z.a,{controlId:"verbose_name"})}),Object(P.e)(pe,{fieldKey:"description",label:Object(A.c)("Description"),control:Object(P.e)(Z.a,{controlId:"description",placeholder:Object(A.c)("Description")})}),Object(P.e)(pe,{fieldKey:"d3format",label:Object(A.c)("D3 Format"),control:Object(P.e)(Z.a,{controlId:"d3format",placeholder:"%y/%m/%d"})}),Object(P.e)(pe,{label:Object(A.c)("Warning Message"),fieldKey:"warning_text",description:Object(A.c)("Warning message to display in the metric selector"),control:Object(P.e)(Z.a,{controlId:"warning_text",placeholder:Object(A.c)("Warning Message")})}),Object(P.e)(pe,{label:Object(A.c)("Certified By"),fieldKey:"certified_by",description:Object(A.c)("Person or group that has certified this metric"),control:Object(P.e)(Z.a,{controlId:"certified_by",placeholder:Object(A.c)("Certified By")})}),Object(P.e)(pe,{label:Object(A.c)("Certification Details"),fieldKey:"certification_details",description:Object(A.c)("Details of the certification"),control:Object(P.e)(Z.a,{controlId:"certification_details",placeholder:Object(A.c)("Certification Details")})}))),collection:this.state.datasource.metrics,allowAddItem:!0,onChange:b()(e=this.onDatasourcePropChange).call(e,this,"metrics"),itemGenerator:()=>({metric_name:"<new metric>",verbose_name:"",expression:""}),itemRenderers:{metric_name:(e,t,a,n)=>Object(P.e)(ve,null,n.is_certified&&Object(P.e)(B,{certifiedBy:n.certified_by,details:n.certification_details}),Object(P.e)(W.a,{canEdit:!0,title:e,onSaveTitle:t})),verbose_name:(e,t)=>Object(P.e)(W.a,{canEdit:!0,title:e,onSaveTitle:t}),expression:(e,t)=>Object(P.e)(W.a,{canEdit:!0,title:e,onSaveTitle:t,extraClasses:["datasource-sql-expression"],multiLine:!0}),description:(e,t,a)=>Object(P.e)(ke,{label:a,formElement:Object(P.e)(Z.a,{value:e,onChange:t})}),d3format:(e,t,a)=>Object(P.e)(ke,{label:a,formElement:Object(P.e)(Z.a,{value:e,onChange:t})})},allowDeletes:!0})}render(){const{datasource:e,activeTabKey:t}=this.state;return Object(P.e)(ye,null,this.renderErrors(),Object(P.e)("div",{className:"m-t-10"},Object(P.e)(D.a,{bsStyle:"warning"},Object(P.e)("strong",null,Object(A.c)("Be careful.")," "),Object(A.c)("Changing these settings will affect all charts using this dataset, including charts owned by other people."))),Object(P.e)(I.a,{id:"table-tabs",onSelect:this.handleTabSelect,defaultActiveKey:t},Object(P.e)(T.a,{eventKey:0,title:Object(A.c)("Source")},0===t&&this.renderSourceFieldset()),Object(P.e)(T.a,{title:Object(P.e)(Te,{collection:e.metrics,title:Object(A.c)("Metrics")}),eventKey:1},1===t&&this.renderMetricCollection()),Object(P.e)(T.a,{title:Object(P.e)(Te,{collection:this.state.databaseColumns,title:Object(A.c)("Columns")}),eventKey:2},2===t&&Object(P.e)("div",null,Object(P.e)(Ee,{columns:this.state.databaseColumns,onChange:e=>this.setColumns({databaseColumns:e})}),Object(P.e)(K.a,{buttonStyle:"primary",onClick:this.syncMetadata,className:"sync-from-source",disabled:!!e.sql,tooltip:e.sql?Object(A.c)("This option is not yet available for views"):null},Object(A.c)("Sync columns from source")),this.state.metadataLoading&&Object(P.e)(V.a,null))),Object(P.e)(T.a,{title:Object(P.e)(Te,{collection:this.state.calculatedColumns,title:Object(A.c)("Calculated Columns")}),eventKey:3},3===t&&Object(P.e)(Ee,{columns:this.state.calculatedColumns,onChange:e=>this.setColumns({calculatedColumns:e}),editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:()=>({column_name:"<new column>",filterable:!0,groupby:!0,expression:"<enter SQL expression here>",__expanded:!0})})),Object(P.e)(T.a,{eventKey:4,title:Object(A.c)("Settings")},4===t&&Object(P.e)("div",null,Object(P.e)(k.a,{md:6},Object(P.e)(De,null,this.renderSettingsFieldset())),Object(P.e)(k.a,{md:6},Object(P.e)(De,null,this.renderAdvancedFieldset()))))))}}Ne.defaultProps={onChange:()=>{}},Ne.propTypes=Ie;t.default=Object(Oe.a)(Ne)},248:function(e,t,a){"use strict";a.d(t,"a",(function(){return R}));a(33);var n=a(18),o=a.n(n),s=a(3),l=a.n(s),r=a(229),i=a.n(r),c=a(64),d=a.n(c),h=a(1085),u=a.n(h),p=a(50),b=a.n(p),m=a(14),g=a.n(m),f=a(6),O=a.n(f),j=a(10),C=a.n(j),y=a(5),v=a.n(y),x=a(0),S=a.n(x),w=a(2),_=a.n(w),T=a(7),E=a(41),k=a(48),D=a(1);const I={autoFocus:_.a.bool,choices:_.a.array,clearable:_.a.bool,description:_.a.string,disabled:_.a.bool,freeForm:_.a.bool,isLoading:_.a.bool,label:_.a.string,multi:_.a.bool,isMulti:_.a.bool,allowAll:_.a.bool,name:_.a.string.isRequired,onChange:_.a.func,onFocus:_.a.func,value:_.a.oneOfType([_.a.string,_.a.number,_.a.array]),showHeader:_.a.bool,optionRenderer:_.a.func,valueRenderer:_.a.func,valueKey:_.a.string,options:_.a.array,placeholder:_.a.string,noResultsText:_.a.string,selectRef:_.a.func,filterOption:_.a.func,promptTextCreator:_.a.func,commaChoosesOption:_.a.bool},N={autoFocus:!1,choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:()=>{},onFocus:()=>{},showHeader:!0,valueKey:"value",noResultsText:Object(T.c)("No results found"),promptTextCreator:e=>"Create Option "+e,commaChoosesOption:!0,allowAll:!1};class R extends S.a.PureComponent{constructor(e){var t,a,n,o;super(e),this.state={options:this.getOptions(e)},this.onChange=v()(t=this.onChange).call(t,this),this.createMetaSelectAllOption=v()(a=this.createMetaSelectAllOption).call(a,this),this.select=null,this.getSelectRef=v()(n=this.getSelectRef).call(n,this),this.handleKeyDownForCreate=v()(o=this.handleKeyDownForCreate).call(o,this)}UNSAFE_componentWillReceiveProps(e){if(e.choices!==this.props.choices||e.options!==this.props.options){const t=this.getOptions(e);this.setState({options:t})}}onChange(e){let t=null;if(e)if(this.props.multi)t=[],C()(e).call(e,e=>{var a,n;!0!==e.meta?t.push(e[this.props.valueKey]||e):this.props.onChange(O()(a=g()(n=this.getOptions(this.props)).call(n,e=>!e.meta)).call(a,e=>e[this.props.valueKey]))});else{if(!0===e.meta)return;t=e[this.props.valueKey]}this.props.onChange(t)}getSelectRef(e){this.select=e,this.props.selectRef&&this.props.selectRef(e)}getOptions(e){let t=[];var a;if(e.options)t=O()(a=e.options).call(a,e=>e);else if(e.choices){var n;t=O()(n=e.choices).call(n,t=>{if(b()(t)){const[a,n]=t.length>1?t:[t[0],t[0]];return{label:n,[e.valueKey]:a}}return u()(t)?t:{label:t,[e.valueKey]:t}})}if(e.freeForm&&e.value){const a=new d.a(O()(t).call(t,t=>t[e.valueKey])),n=b()(e.value)?e.value:[e.value];C()(n).call(n,n=>{a.has(n)||t.unshift({label:n,[e.valueKey]:n})})}return!0===e.allowAll&&!0===e.multi?i()(t).call(t,e=>this.isMetaSelectAllOption(e))<0&&t.unshift(this.createMetaSelectAllOption()):t=g()(t).call(t,e=>!this.isMetaSelectAllOption(e)),t}handleKeyDownForCreate(e){const{key:t}=e;("Tab"===t||this.props.commaChoosesOption&&","===t)&&this.select&&this.select.onKeyDown(l()({},e,{key:"Enter"}))}isMetaSelectAllOption(e){return e.meta&&!0===e.meta&&"Select All"===e.label}createMetaSelectAllOption(){const e={label:"Select All",meta:!0};return e[this.props.valueKey]="Select All",e}render(){const e=this.props.placeholder||Object(T.c)("%s option(s)",this.state.options.length),t=this.props.isMulti||this.props.multi,a={autoFocus:this.props.autoFocus,isMulti:t,selectRef:this.getSelectRef,name:"select-"+this.props.name,placeholder:e,options:this.state.options,value:this.props.value,labelKey:"label",valueKey:this.props.valueKey,clearable:this.props.clearable,isLoading:this.props.isLoading,onChange:this.onChange,onFocus:this.props.onFocus,optionRenderer:this.props.optionRenderer,valueRenderer:this.props.valueRenderer,noResultsText:this.props.noResultsText,disabled:this.props.disabled,filterOption:this.props.filterOption,promptTextCreator:this.props.promptTextCreator,ignoreAccents:!1};let n;return this.props.freeForm?(n=E.c,a.onKeyDown=this.handleKeyDownForCreate):n=E.f,Object(D.e)("div",null,this.props.showHeader&&Object(D.e)(k.a,this.props),t?Object(D.e)(E.d,o()({},a,{selectWrap:n})):Object(D.e)(n,a))}}R.propTypes=I,R.defaultProps=N},250:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a(0);var n=a(2),o=a.n(n),s=a(102),l=a(1);const r={title:o.a.string.isRequired,isSelected:o.a.bool.isRequired,onSelect:o.a.func.isRequired,info:o.a.string,children:o.a.node.isRequired};function i({title:e,isSelected:t,children:a,onSelect:n,info:o}){return Object(l.e)("div",{className:"PopoverSection "+(t?"":"dimmed")},Object(l.e)("div",{role:"button",tabIndex:0,onClick:n,className:"pointer"},Object(l.e)("strong",null,e),"  ",o&&Object(l.e)(s.a,{tooltip:o,label:"date-free-tooltip"})," ",Object(l.e)("i",{className:t?"fa fa-check text-primary":""})),Object(l.e)("div",{className:"m-t-5 m-l-5"},a))}i.propTypes=r},276:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(18),o=a.n(n),s=a(5),l=a.n(s),r=a(0),i=a.n(r),c=a(2),d=a.n(c),h=a(48),u=a(349),p=a(1);const b={value:d.a.bool,label:d.a.string,onChange:d.a.func},m={paddingRight:"5px"};class g extends i.a.Component{onChange(){this.props.onChange(!this.props.value)}renderCheckbox(){var e;return Object(p.e)(u.a,{onChange:l()(e=this.onChange).call(e,this),style:m,checked:!!this.props.value})}render(){var e;return this.props.label?Object(p.e)(h.a,o()({},this.props,{leftNode:this.renderCheckbox(),onClick:l()(e=this.onChange).call(e,this)})):this.renderCheckbox()}}g.propTypes=b,g.defaultProps={value:!1,onChange:()=>{}}},331:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return l}));a(0);var n=a(1);const o=()=>Object(n.e)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Object(n.e)("path",{d:"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z",fill:"#20A7C9"}),Object(n.e)("path",{d:"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z",fill:"white"})),s=()=>Object(n.e)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Object(n.e)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:"#999999"}),Object(n.e)("path",{d:"M14 10H4V8H14V10Z",fill:"white"})),l=()=>Object(n.e)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Object(n.e)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:"#CCCCCC"}),Object(n.e)("path",{d:"M16 2V16H2V2H16V2Z",fill:"white"}))},349:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(11),o=a.n(n),s=(a(0),a(56)),l=a(331),r=a(1);function i(){const e=o()(["\n  &,\n  & svg {\n    vertical-align: top;\n  }\n"]);return i=function(){return e},e}const c=s.a.span(i());function d({checked:e,onChange:t,style:a}){return Object(r.e)(c,{style:a,onClick:()=>{t(!e)},role:"checkbox",tabIndex:0,"aria-checked":e,"aria-label":"Checkbox"},e?Object(r.e)(l.a,null):Object(r.e)(l.c,null))}},3498:function(e,t,a){},469:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));a(33);var n=a(253),o=a.n(n),s=a(0),l=a(8),r=a.n(l),i=a(7),c=a(83),d=a(1);function h({canEdit:e=!1,emptyText:t,extraClasses:a,multiLine:n=!1,noPermitTooltip:l,onSaveTitle:h,showTooltip:u=!0,style:p,title:b}){const[m,g]=Object(s.useState)(!1),[f,O]=Object(s.useState)(b),[j,C]=Object(s.useState)(b),[y,v]=Object(s.useState)(null),x=Object(s.useRef)();function S(){if(!e||m)return;const t=x.current?x.current.getBoundingClientRect():null;g(!0),v(t)}function w(){const t=o()(f).call(f);e&&(g(!1),t.length?(j!==t&&C(t),b!==t&&h(t)):O(j))}function _(e){" "===e.key&&e.stopPropagation()}function T(t){e&&O(t.target.value)}function E(e){"Enter"===e.key&&(e.preventDefault(),w())}let k;Object(s.useEffect)(()=>{f!==j&&(C(f),O(b))},[b]),f?k=f:m||(k=t);const D=m&&y?{height:y.height+"px"}:void 0;let I=n&&m?Object(d.e)("textarea",{ref:x,required:!0,value:k,className:b?void 0:"text-muted",onKeyDown:_,onChange:T,onBlur:w,onClick:S,onKeyPress:E,style:D}):Object(d.e)("input",{ref:x,required:!0,type:m?"text":"button",value:k,className:b?void 0:"text-muted",onKeyDown:_,onChange:T,onBlur:w,onClick:S,onKeyPress:E});return u&&!m&&(I=Object(d.e)(c.a,{label:"title",tooltip:e?Object(i.c)("click to edit"):l||Object(i.c)("You don't have the rights to alter this title.")},I)),Object(d.e)("span",{className:r()("editable-title",a,e&&"editable-title--editable",m&&"editable-title--editing"),style:p},I)}},676:function(e,t,a){"use strict";var n=a(0),o=a.n(n),s=a(2),l=a.n(s),r=a(83),i=(a(1233),a(1));const c={onClick:l.a.func,tooltipContent:l.a.string.isRequired};class d extends o.a.PureComponent{render(){return Object(i.e)(r.a,{tooltip:this.props.tooltipContent,label:"cache-desc"},Object(i.e)("i",{"aria-label":"Icon",role:"button",tabIndex:0,className:"RefreshLabel fa fa-refresh pointer",onClick:this.props.onClick}))}}d.propTypes=c,t.a=d},933:function(e,t,a){"use strict";var n=a(6),o=a.n(n),s=(a(0),a(2)),l=a.n(s),r=a(7),i=a(351),c=a(48),d=a(73),h=a(1);const u={dataEndpoint:l.a.string.isRequired,multi:l.a.bool,mutator:l.a.func,onAsyncErrorMessage:l.a.string,onChange:l.a.func,placeholder:l.a.string,value:l.a.oneOfType([l.a.string,l.a.number,l.a.arrayOf(l.a.string),l.a.arrayOf(l.a.number)]),addDangerToast:l.a.func.isRequired},p={multi:!0,onAsyncErrorMessage:Object(r.c)("Error while fetching data"),onChange:()=>{},placeholder:Object(r.c)("Select ...")},b=e=>{const{value:t,onChange:a,dataEndpoint:n,multi:s,mutator:l,placeholder:r,onAsyncErrorMessage:d}=e;return Object(h.e)("div",null,Object(h.e)(c.a,e),Object(h.e)(i.a,{dataEndpoint:n,onChange:e=>{let t;t=s?o()(e).call(e,e=>e.value):e?e.value:null,a(t)},onAsyncError:t=>e.addDangerToast(d+": "+t),mutator:l,multi:s,value:t,placeholder:r,valueRenderer:e=>Object(h.e)("div",null,e.label)}))};b.propTypes=u,b.defaultProps=p,t.a=Object(d.a)(b)},934:function(e,t,a){"use strict";a.d(t,"a",(function(){return C}));var n=a(5),o=a.n(n),s=a(192),l=a.n(s),r=a(0),i=a.n(r),c=a(2),d=a.n(c),h=a(314),u=a(306),p=a(7),b=a(21),m=a(153),g=a(116),f=a(48),O=a(1);const j={name:d.a.string,onChange:d.a.func,value:d.a.string,height:d.a.number,minLines:d.a.number,maxLines:d.a.number,offerEditInModal:d.a.bool,language:d.a.oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:d.a.node,readOnly:d.a.bool};class C extends i.a.Component{constructor(){super(),this.onAceChangeDebounce=l()(e=>{this.onAceChange(e)},300)}onControlChange(e){this.props.onChange(e.target.value)}onAceChange(e){this.props.onChange(e)}renderEditor(e=!1){var t;const a=this.props.value||"",n=e?40:this.props.minLines||12;return this.props.language?Object(O.e)(m.g,{mode:this.props.language,style:{border:"1px solid #CCC"},minLines:n,maxLines:e?1e3:this.props.maxLines,onChange:this.onAceChangeDebounce,width:"100%",height:n+"em",editorProps:{$blockScrolling:!0},value:a,readOnly:this.props.readOnly}):Object(O.e)(h.a,{controlId:"formControlsTextarea"},Object(O.e)(u.a,{componentClass:"textarea",placeholder:Object(p.c)("textarea"),onChange:o()(t=this.onControlChange).call(t,this),value:a,disabled:this.props.readOnly,style:{height:this.props.height}}))}renderModalBody(){return Object(O.e)("div",null,Object(O.e)("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}render(){const e=Object(O.e)(f.a,this.props);return Object(O.e)("div",null,e,this.renderEditor(),this.props.offerEditInModal&&Object(O.e)(g.a,{bsSize:"large",modalTitle:e,triggerNode:Object(O.e)(b.a,{buttonSize:"small",className:"m-t-5"},Object(p.c)("Edit")," ",Object(O.e)("strong",null,this.props.language)," ",Object(p.c)("in modal")),modalBody:this.renderModalBody(!0)}))}}C.propTypes=j,C.defaultProps={onChange:()=>{},value:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1}},935:function(e,t,a){"use strict";a.d(t,"a",(function(){return x}));var n=a(5),o=a.n(n),s=a(0),l=a.n(s),r=a(2),i=a.n(r),c=a(850),d=a(692),h=a(7),u=a(63),p=a(124).f,b=a(250),m=a(349),g=a(48),f=a(248),O=a(1);const j="latlong",C="delimited",y="geohash",v={onChange:i.a.func,value:i.a.object,animation:i.a.bool,choices:i.a.array};class x extends l.a.Component{constructor(e){var t,a,n;super(e);const s=e.value||{};let l;e.choices.length>0&&(l=e.choices[0][0]),this.state={type:s.type||j,delimiter:s.delimiter||",",latCol:s.latCol||l,lonCol:s.lonCol||l,lonlatCol:s.lonlatCol||l,reverseCheckbox:s.reverseCheckbox||!1,geohashCol:s.geohashCol||l,value:null,errors:[]},this.toggleCheckbox=o()(t=this.toggleCheckbox).call(t,this),this.onChange=o()(a=this.onChange).call(a,this),this.renderReverseCheckbox=o()(n=this.renderReverseCheckbox).call(n,this)}componentDidMount(){this.onChange()}onChange(){const{type:e}=this.state,t={type:e},a=[],n=Object(h.c)("Invalid lat/long configuration.");e===j?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||a.push(n)):e===C?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||a.push(n)):e===y&&(t.geohashCol=this.state.geohashCol,t.reverseCheckbox=this.state.reverseCheckbox,t.geohashCol||a.push(n)),this.setState({value:t,errors:a}),this.props.onChange(t,a)}setType(e){this.setState({type:e},this.onChange)}toggleCheckbox(){this.setState(e=>({reverseCheckbox:!e.reverseCheckbox}),this.onChange)}renderLabelContent(){return this.state.errors.length>0?"N/A":this.state.type===j?this.state.lonCol+" | "+this.state.latCol:this.state.type===C?""+this.state.lonlatCol:this.state.type===y?""+this.state.geohashCol:null}renderSelect(e,t){return Object(O.e)(f.a,{name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:()=>{this.setType(t)},onChange:t=>{this.setState({[e]:t},this.onChange)}})}renderReverseCheckbox(){return Object(O.e)("span",null,Object(h.c)("Reverse lat/long "),Object(O.e)(m.a,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox}))}renderPopoverContent(){var e,t,a;return Object(O.e)("div",{style:{width:"300px"}},Object(O.e)(b.a,{title:Object(h.c)("Longitude & Latitude columns"),isSelected:this.state.type===j,onSelect:o()(e=this.setType).call(e,this,j)},Object(O.e)(c.a,null,Object(O.e)(d.a,{md:6},"Longitude",this.renderSelect("lonCol",j)),Object(O.e)(d.a,{md:6},"Latitude",this.renderSelect("latCol",j)))),Object(O.e)(b.a,{title:Object(h.c)("Delimited long & lat single column"),info:Object(h.c)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===C,onSelect:o()(t=this.setType).call(t,this,C)},Object(O.e)(c.a,null,Object(O.e)(d.a,{md:6},Object(h.c)("Column"),this.renderSelect("lonlatCol",C)),Object(O.e)(d.a,{md:6},this.renderReverseCheckbox()))),Object(O.e)(b.a,{title:Object(h.c)("Geohash"),isSelected:this.state.type===y,onSelect:o()(a=this.setType).call(a,this,y)},Object(O.e)(c.a,null,Object(O.e)(d.a,{md:6},"Column",this.renderSelect("geohashCol",y)),Object(O.e)(d.a,{md:6},this.renderReverseCheckbox()))))}render(){return Object(O.e)("div",null,Object(O.e)(g.a,this.props),Object(O.e)(p,{content:this.renderPopoverContent(),placement:"topLeft",trigger:"click"},Object(O.e)(u.a,{className:"pointer"},this.renderLabelContent())))}}x.propTypes=v,x.defaultProps={onChange:()=>{},animation:!0,choices:[]}},938:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));a(113),a(33);var n=a(14),o=a.n(n),s=a(3),l=a.n(s),r=a(55),i=a.n(r),c=a(6),d=a.n(c),h=a(11),u=a.n(h),p=a(0),b=a(56),m=a(89),g=a(7),f=a(154),O=a.n(f),j=a(41),C=a(63),y=a(351),v=a(676),x=a(1);function S(){const e=u()(["\n  .fa-refresh {\n    padding-left: 9px;\n  }\n\n  .refresh-col {\n    display: flex;\n    align-items: center;\n    width: 30px;\n  }\n\n  .section {\n    padding-bottom: 5px;\n    display: flex;\n    flex-direction: row;\n  }\n\n  .select {\n    flex-grow: 1;\n  }\n"]);return S=function(){return e},e}function w(){const e=u()(["\n  color: ",";\n  font-size: ","px;\n  margin: 20px 0 10px 0;\n  text-transform: uppercase;\n"]);return w=function(){return e},e}const _=b.a.p(w(),({theme:e})=>e.colors.secondary.light2,({theme:e})=>e.typography.sizes.s),T=b.a.div(S());function E({dbId:e,formMode:t=!1,getDbList:a,getTableList:n,handleError:s,isDatabaseSelectEnabled:r=!0,onChange:c,onDbChange:h,onSchemaChange:u,onSchemasLoad:b,schema:f,sqlLabMode:S=!1}){const[w,E]=Object(p.useState)(e),[k,D]=Object(p.useState)(f),[I,N]=Object(p.useState)(!1),[R,L]=Object(p.useState)([]);function A(t,a=!1){const n=t||e;if(n){N(!0);const e="/api/v1/database/"+n+"/schemas/?q="+O.a.encode({force:Boolean(a)});return m.a.get({endpoint:e}).then(({json:e})=>{var t;const a=d()(t=e.result).call(t,e=>({value:e,label:e,title:e}));L(a),N(!1),b&&b(a)}).catch(()=>{L([]),N(!1),s(Object(g.c)("Error while fetching schema list"))})}return i.a.resolve()}function M({dbId:e,schema:t}){E(e),D(t),c&&c({dbId:e,schema:t,tableName:void 0})}function K(e){var t;return a&&a(e.result),0===e.result.length&&s(Object(g.c)("It seems you don't have access to any database")),d()(t=e.result).call(t,e=>l()({},e,{label:e.backend+" "+e.database_name}))}function F(e,t=!1){const a=e?e.id:null;L([]),u&&u(null),h&&h(e),A(a,t),M({dbId:a,schema:void 0})}function q(e){return Object(x.e)("span",{title:e.database_name},Object(x.e)(C.a,{bsStyle:"default"},e.backend),e.database_name)}function P(e,t){return Object(x.e)("div",{className:"section"},Object(x.e)("span",{className:"select"},e),Object(x.e)("span",{className:"refresh-col"},t))}return Object(p.useEffect)(()=>{w&&A(w)},[w]),Object(x.e)(T,null,t&&Object(x.e)(_,null,Object(g.c)("datasource")),function(){const e=O.a.encode(l()({order_columns:"database_name",order_direction:"asc",page:0,page_size:-1},t||!S?{}:{filters:[{col:"expose_in_sqllab",opr:"eq",value:!0}]}));return P(Object(x.e)(y.a,{"data-test":"select-database",dataEndpoint:"/api/v1/database/?q="+e,onChange:e=>F(e),onAsyncError:()=>s(Object(g.c)("Error while fetching database list")),clearable:!1,value:w,valueKey:"id",valueRenderer:e=>Object(x.e)("div",null,Object(x.e)("span",{className:"text-muted m-r-5"},Object(g.c)("Database:")),q(e)),optionRenderer:q,mutator:K,placeholder:Object(g.c)("Select a database"),autoSelect:!0,isDisabled:!r}),null)}(),t&&Object(x.e)(_,null,Object(g.c)("schema")),function(){const a=o()(R).call(R,({value:e})=>k===e),s=!t&&Object(x.e)(v.a,{onClick:()=>F({id:e},!0),tooltipContent:Object(g.c)("Force refresh schema list")});return P(Object(x.e)(j.f,{name:"select-schema",placeholder:Object(g.c)("Select a schema (%s)",R.length),options:R,value:a,valueRenderer:e=>Object(x.e)("div",null,Object(x.e)("span",{className:"text-muted"},Object(g.c)("Schema:"))," ",e.label),isLoading:I,autosize:!1,onChange:e=>function(e,t=!1){const a=e?e.value:null;u&&u(a),D(a),M({dbId:w,schema:a}),n&&n(w,a,t)}(e)}),s)}())}},993:function(e,t,a){"use strict";a(113),a(33);var n=a(55),o=a.n(n),s=a(6),l=a.n(s),r=a(11),i=a.n(r),c=a(0),d=a(56),h=a(89),u=a(7),p=a(41),b=a(69),m=a(938),g=a(676),f=a(1);function O(){const e=i()(["\n  white-space: nowrap;\n"]);return O=function(){return e},e}function j(){const e=i()(["\n  .fa-refresh {\n    padding-left: 9px;\n  }\n\n  .refresh-col {\n    display: flex;\n    align-items: center;\n    width: 30px;\n  }\n\n  .section {\n    padding-bottom: 5px;\n    display: flex;\n    flex-direction: row;\n  }\n\n  .select {\n    flex-grow: 1;\n  }\n\n  .divider {\n    border-bottom: 1px solid ",";\n    margin: 15px 0;\n  }\n"]);return j=function(){return e},e}function C(){const e=i()(["\n  color: ",";\n  font-size: ","px;\n  margin: 20px 0 10px 0;\n  text-transform: uppercase;\n"]);return C=function(){return e},e}const y=d.a.p(C(),({theme:e})=>e.colors.secondary.light2,({theme:e})=>e.typography.sizes.s),v=d.a.div(j(),({theme:e})=>e.colors.secondary.light5),x=d.a.span(O());t.a=({database:e,dbId:t,formMode:a=!1,getDbList:n,handleError:s,isDatabaseSelectEnabled:r=!0,onChange:i,onDbChange:d,onSchemaChange:O,onSchemasLoad:j,onTableChange:C,onTablesLoad:S,schema:w,sqlLabMode:_=!0,tableName:T,tableNameSticky:E=!0})=>{const[k,D]=Object(c.useState)(w),[I,N]=Object(c.useState)(T),[R,L]=Object(c.useState)(!1),[A,M]=Object(c.useState)([]);function K(e,a,n=!1,r="undefined"){const i=a||k,c=e||t;if(c&&i){const e=encodeURIComponent(i),t=encodeURIComponent(r);L(!0),M([]);const a=encodeURI("/superset/tables/"+c+"/"+e+"/"+t+"/"+!!n+"/");return h.a.get({endpoint:a}).then(({json:e})=>{var t;const a=l()(t=e.options).call(t,e=>({value:e.value,schema:e.schema,label:e.label,title:e.title,type:e.type}));L(!1),M(a),S&&S(e.options)}).catch(()=>{L(!1),M([]),s(Object(u.c)("Error while fetching table list"))})}return L(!1),M([]),o.a.resolve()}function F({dbId:e,schema:t,tableName:a}){N(a),D(t),i&&i({dbId:e,schema:t,tableName:a})}function q(e="undefined"){if(!t||!e){const e=[];return o.a.resolve({options:e})}const a=encodeURIComponent(w||""),n=encodeURIComponent(e);return h.a.get({endpoint:encodeURI("/superset/tables/"+t+"/"+a+"/"+n)}).then(({json:e})=>{var t;return{options:l()(t=e.options).call(t,e=>({value:e.value,schema:e.schema,label:e.label,title:e.title,type:e.type}))}})}function P(e){if(!e)return void N("");const a=e.schema,n=e.value;E&&F({dbId:t,schema:a,tableName:n}),C&&C(n,a)}function B(e){return Object(f.e)(x,{title:e.label},Object(f.e)("span",{className:"m-r-5"},Object(f.e)("small",{className:"text-muted"},Object(f.e)("i",{className:"fa fa-"+("view"===e.type?"eye":"table")}))),e.label)}return Object(c.useEffect)(()=>{t&&w&&K()},[t,w]),Object(f.e)(v,null,Object(f.e)(m.a,{dbId:t,formMode:a,getDbList:n,getTableList:K,handleError:s,onChange:F,onDbChange:d,onSchemaChange:O,onSchemasLoad:j,schema:k,sqlLabMode:_,isDatabaseSelectEnabled:r}),!a&&Object(f.e)("div",{className:"divider"}),_&&Object(f.e)("div",{className:"section"},Object(f.e)(b.a,null,Object(u.c)("See table schema")," ",w&&Object(f.e)("small",null,A.length," in",Object(f.e)("i",null,w)))),a&&Object(f.e)(y,null,Object(u.c)("Table")),function(){let n,o=!1;e&&e.allow_multi_schema_metadata_fetch?n=Object(u.c)("Type to search ..."):(n=Object(u.c)("Select table "),o=!0);const s=A;let l=null;return l=k&&!a?Object(f.e)(p.f,{name:"select-table",isLoading:R,ignoreAccents:!1,placeholder:Object(u.c)("Select table or type table name"),autosize:!1,onChange:P,options:s,value:I,optionRenderer:B}):a?Object(f.e)(p.c,{name:"select-table",isLoading:R,ignoreAccents:!1,placeholder:Object(u.c)("Select table or type table name"),autosize:!1,onChange:P,options:s,value:I,optionRenderer:B}):Object(f.e)(p.b,{name:"async-select-table",placeholder:n,isDisabled:o,autosize:!1,onChange:P,value:I,loadOptions:q,optionRenderer:B}),function(e,t){return Object(f.e)("div",{className:"section"},Object(f.e)("span",{className:"select"},e),Object(f.e)("span",{className:"refresh-col"},t))}(l,!a&&Object(f.e)(g.a,{onClick:()=>function(e,a=!1){const n=e?e.value:null;O&&O(n),F({dbId:t,schema:n,tableName:void 0}),K(t,k,a)}({value:w},!0),tooltipContent:Object(u.c)("Force refresh table list")}))}())}}}]);