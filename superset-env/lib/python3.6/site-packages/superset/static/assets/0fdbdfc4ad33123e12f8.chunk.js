(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{3997:function(t,e){t.exports=n,n.default=n,n.stable=s,n.stableStringify=s;var r=[],a=[];function n(t,e,n){var o;for(!function t(e,n,o,s){var i;if("object"==typeof e&&null!==e){for(i=0;i<o.length;i++)if(o[i]===e){var u=Object.getOwnPropertyDescriptor(s,n);return void(void 0!==u.get?u.configurable?(Object.defineProperty(s,n,{value:"[Circular]"}),r.push([s,n,e,u])):a.push([e,n]):(s[n]="[Circular]",r.push([s,n,e])))}if(o.push(e),Array.isArray(e))for(i=0;i<e.length;i++)t(e[i],i,o,e);else{var l=Object.keys(e);for(i=0;i<l.length;i++){var c=l[i];t(e[c],c,o,e)}}o.pop()}}(t,"",[],void 0),o=0===a.length?JSON.stringify(t,e,n):JSON.stringify(t,i(e),n);0!==r.length;){var s=r.pop();4===s.length?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}return o}function o(t,e){return t<e?-1:t>e?1:0}function s(t,e,n){var s,u=function t(e,n,s,i){var u;if("object"==typeof e&&null!==e){for(u=0;u<s.length;u++)if(s[u]===e){var l=Object.getOwnPropertyDescriptor(i,n);return void(void 0!==l.get?l.configurable?(Object.defineProperty(i,n,{value:"[Circular]"}),r.push([i,n,e,l])):a.push([e,n]):(i[n]="[Circular]",r.push([i,n,e])))}if("function"==typeof e.toJSON)return;if(s.push(e),Array.isArray(e))for(u=0;u<e.length;u++)t(e[u],u,s,e);else{var c={},p=Object.keys(e).sort(o);for(u=0;u<p.length;u++){var f=p[u];t(e[f],f,s,e),c[f]=e[f]}if(void 0===i)return c;r.push([i,n,e]),i[n]=c}s.pop()}}(t,"",[],void 0)||t;for(s=0===a.length?JSON.stringify(u,e,n):JSON.stringify(u,i(e),n);0!==r.length;){var l=r.pop();4===l.length?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}return s}function i(t){return t=void 0!==t?t:function(t,e){return e},function(e,r){if(a.length>0)for(var n=0;n<a.length;n++){var o=a[n];if(o[1]===e&&o[0]===r){r="[Circular]",a.splice(n,1);break}}return t.call(this,e,r)}}},4405:function(t,e,r){"use strict";r.r(e);var a=r(147),n=r.n(a),o=r(0),s=r.n(o),i=r(2),u=r.n(i),l=r(340),c=r(239),p=r.n(c),f=r(3997),h=r.n(f);var d=r(4334),y=r(68);function v(){return(v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t}).apply(this,arguments)}const g={width:u.a.number,height:u.a.number,annotationData:u.a.object,datasource:u.a.object,formData:u.a.object,queryData:u.a.object,rawFormData:u.a.object,hooks:u.a.shape({onAddFilter:u.a.func,onError:u.a.func})};class b extends s.a.Component{constructor(t){super(t),this.state={queryData:!1}}componentDidMount(){this.loadData(this.props)}shouldComponentUpdate(t,e){const{rawFormData:r}=this.props,{rawFormData:a}=t,{queryData:n}=this.state,{queryData:o}=e;return!Object(l.isEqual)(n,o)||!Object(l.isEqual)(r,a)}componentDidUpdate(){this.loadData(this.props)}loadData(t){const{formData:e,queryData:r}=t,{slices:a}=r.data,{extraFilters:o,filters:s,lineCharts:i,lineCharts2:u,prefixMetricWithSliceName:l,timeRange:c}=e,f=[...a.axis1.map(t=>[1,t]),...a.axis2.map(t=>[2,t])].map(([t,e])=>{const r=e.form_data,a=v({},e.form_data,{extra_filters:o||[],filters:(r.filters||[]).concat(s||[]),time_range:c}),i=l;return function(t){return new Promise((e,r)=>{n.a.json(t,(t,a)=>{t?r(t):e(a.data)})})}(function t(e,r,a=!0,n={}){if(!e.datasource)return null;const o=new p.a("/"),s=function(t,e="base"){let r="/superset/explore/";return["json","csv","query","results","samples"].includes(e)&&(r="/superset/explore_json/"),r}(0,r),i=o.search(!0);Object.keys(n).forEach(t=>{i[t]=n[t]}),i.form_data=h()(e),"standalone"===r&&(i.standalone="true");const u=o.directory(s).search(i).toString();if(!a&&u.length>8e3){return t({datasource:e.datasource,viz_type:e.viz_type},r,!1,{URL_IS_TOO_LONG_TO_SHARE:null})}return u}(a,"json")).then(r=>r.map(({key:r,values:n})=>({key:i?e.slice_name+": "+r:r,type:a.viz_type,values:n,yAxis:t})))});Promise.all(f).then(t=>{const e=v({},r);if(e.data=[].concat(...t),i.length>0&&u.length>0){let t=1/0,r=-1/0;e.data.forEach(e=>{t=Math.min(t,...e.values.map(t=>t.x)),r=Math.max(r,...e.values.map(t=>t.x))}),e.data.forEach(e=>{e.values.push({x:t,y:null}),e.values.push({x:r,y:null})})}this.setState({queryData:e})})}render(){const{queryData:t}=this.state;return(s.a.createElement(d.default,Object(y.a)(v({},this.props,{queryData:t}))))}}b.propTypes=g,b.defaultProps={};e.default=b}}]);